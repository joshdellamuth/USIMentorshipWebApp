@using USIMentorshipWebApp.Data
@using USIMentorshipWebApp.Models
@inject AdminPortalService adminPortalService
@using Radzen
@using Radzen.Blazor
@using Microsoft.EntityFrameworkCore


<style>
    .rz-grid-table {
        width: unset;
    }
</style>

<RadzenDataGrid @ref="usersGrid" PageSize="5" AllowFiltering="true" AllowPaging="true" AllowSorting="true" Data="@allUsers"
                TItem="User" EditMode="@editMode" RowUpdate="@OnUpdateRow">

    <Columns>
        <RadzenDataGridColumn TItem="User" Property="UserId" Title="User ID">
            <EditTemplate>
                <RadzenText Text="Hi i am indicator text"></RadzenText>
            </EditTemplate>
        </RadzenDataGridColumn>

        <RadzenDataGridColumn TItem="User" Property="FirstName" Title="First Name">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="LastName" Title="Last Name">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="Password" Title="Password">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="PhoneNumber" Title="Phone Number">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="EmailAddress" Title="Email Address">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="ProfilePicture" Title="Email Address">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="LinkedInLink" Title="LinkedIn Link">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="Bio" Title="Bio">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="Status" Title="Account Status">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="Major" Title="Major">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="Minor" Title="Minor">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="Industry" Title="Industry">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="Company" Title="Company">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="CurrentPosition" Title="Current Position">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="DateOfBirth" Title="Date Of Birth">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="GraduationYear" Title="Graduation Year">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="Gender" Title="Gender">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="School" Title="School">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="MenteesPerSemester" Title="Mentees Per Semester">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="BusinessCityId" Title="Business City Id">

        </RadzenDataGridColumn>
        <RadzenDataGridColumn TItem="User" Property="BusinessStateCode" Title="Business State Code">

        </RadzenDataGridColumn>

        <RadzenDataGridColumn TItem="User" Property="BusinessCountryCode" Title="Business Country Code">

        </RadzenDataGridColumn>

        <RadzenDataGridColumn TItem="User" Context="user" Filterable="false" Sortable="false" TextAlign="TextAlign.Right" Frozen="true" FrozenPosition="FrozenColumnPosition.Right">
            <Template>
                <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium"></RadzenButton>
            </Template>
            <EditTemplate>
                <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success" Variant="Variant.Flat" Size="ButtonSize.Medium"></RadzenButton>

                <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium" class="my-1 ms-1"> </RadzenButton>
            </EditTemplate>
        </RadzenDataGridColumn>



    </Columns>
</RadzenDataGrid>

@code {
    RadzenDataGrid<User> usersGrid;
    List<User>? allUsers;
    List<User> usersToUpdate = new List<User>();
    List<User> usersToInsert = new List<User>();

    void Reset()
    {
        usersToInsert.Clear();
        usersToUpdate.Clear();
    }

    void Reset(User user)
    {
        usersToInsert.Remove(user);
        usersToUpdate.Remove(user);
    }

    protected override async Task OnInitializedAsync()
    {
        allUsers = await adminPortalService.GetAllUsers();
    }

    DataGridEditMode editMode = DataGridEditMode.Single;

    async Task EditRow(User user)
    {
        if (editMode == DataGridEditMode.Single)
        {
            Reset();
        }

        usersToUpdate.Add(user);
        await usersGrid.EditRow(user);
    }

    void OnUpdateRow(User user)
    {
        Reset(user);

        //dbContext.Update(user);

        //dbContext.SaveChanges();
    }

    async Task SaveRow(User user)
    {
        await usersGrid.UpdateRow(user);
    }

    void CancelEdit(User user)
    {
         Reset(user);

         usersGrid.CancelEditRow(user);

         // var orderEntry = dbContext.Entry(user);
         // if (orderEntry.State == EntityState.Modified)
         // {
         //     orderEntry.CurrentValues.SetValues(orderEntry.OriginalValues);
         //     orderEntry.State = EntityState.Unchanged;
         // }

         
    }
}