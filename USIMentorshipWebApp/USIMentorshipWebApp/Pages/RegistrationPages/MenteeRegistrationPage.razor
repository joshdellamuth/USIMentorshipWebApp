@page "/mentee-registration"
@layout NotLoggedInLayout

@inject NavigationManager NavigationManager
@inject DialogService DialogService
@inject UserService UserService
@using USIMentorshipWebApp.Models;
@using USIMentorshipWebApp.Data;
@using Radzen
@using System.Text.Json     
@* Added using radzen and system.text.json for validator
 *@

<PageTitle>Mentee Sign Up - USI Mentorship Program</PageTitle>

<div class="default-margin">
    <h1>Sign up as a Mentee</h1>


         <RadzenTemplateForm TItem="User" Data="@user" Submit="@OnSubmit">

            @* FIRSTNAME, LASTNAME *@
            <RadzenRow class="mb-4 mt-4" Gap="25">
                

                <RadzenFormField Text="First Name:" AllowFloatingLabel="false" Variant=Variant.Flat>
                    <RadzenStack Orientation="Orientation.Vertical">
                        <RadzenTextBox @bind-Value="@user.FirstName" Name="FirstName" />
                        <RadzenRequiredValidator Text="First name is required" Component="FirstName" />
                    </RadzenStack>
                </RadzenFormField>




                <RadzenFormField Text="Last Name:" AllowFloatingLabel="false" Variant=Variant.Flat>
                    <RadzenTextBox @bind-Value="@user.LastName" Name="LastName" />
                    <RadzenRequiredValidator Text="Last name is required" Component="LastName" />
                </RadzenFormField>
            </RadzenRow>

            @* EMAIL, PHONE NUMBER *@
            <RadzenRow class="mb-4" Gap="25">
                <RadzenFormField Text="Email:" AllowFloatingLabel="false" Variant=Variant.Flat>
                    <RadzenTextBox @bind-Value="@user.EmailAddress" Name="EmailAddress" />
                    <RadzenRequiredValidator Text="EmailAddress is required" Component="EmailAddress" />    
                 </RadzenFormField>

                <RadzenFormField Text="Phone Number:" AllowFloatingLabel="false" Variant=Variant.Flat>
                    <RadzenTextBox @bind-Value="@user.PhoneNumber" Name="PhoneNumber" />
                    <RadzenRequiredValidator Text="Phone Number is required" Component="PhoneNumber" />
                </RadzenFormField>

            </RadzenRow>

            @* LinkedIn *@
            <RadzenRow class="mb-4" Gap="25">

                <RadzenFormField Text="LinkedIn Profile URL:" AllowFloatingLabel="false" Variant=Variant.Flat>
                    <RadzenTextBox @bind-Value="@user.LinkedInLink" Name="LinkedIn" />
                    <RadzenRequiredValidator Text="LinkedIn is required" Component="LinkedIn" />
                </RadzenFormField>

            </RadzenRow>

            @* UPLOAD PROFILE PICTURE *@
            <RadzenRow class="mb-4">
                <RadzenUpload Url="upload/single" ChooseText="Upload Profile Picture" Style="width:180px; text-align:center;" Accept="image/*"></RadzenUpload>
            </RadzenRow>




            @* SCHOOL, MAJOR, MINOR, GRADUATION YEAR *@
            <h3>Education Information:</h3>
            <RadzenRow class="mb-4 mt-4" AlignItems="AlignItems.Center" Gap="25">


                <RadzenFormField Text="Major:" AllowFloatingLabel="false" Variant=Variant.Flat>
                    <RadzenTextBox @bind-Value=@user.Major Name="Major" />
                <RadzenRequiredValidator Text="Major is required" Component="Major" />
                </RadzenFormField>

                <RadzenFormField Text="Minor:" AllowFloatingLabel="false" Variant=Variant.Flat>
                    <RadzenTextBox @bind-Value="@user.Minor" />
                </RadzenFormField>

            </RadzenRow>



            @* BIRTHDATE, SELF-INTRODUCTION, MENTEES PER SEMESTER *@
            <h3>Further Profile Info</h3>
            <h6>Some of this information will be used in your profile for students to see</h6>


            <RadzenRow class="mb-4 mt-4" Gap="25">
                <div class="our-column">
                    <label>Self-Introduction</label>
                    <RadzenTextArea @bind-Value=@user.Bio Cols="55" Rows="6" aria-label=Self-Introduction: />
                </div>
            </RadzenRow>



            @* PASSWORD *@
            <RadzenRow>
                <RadzenFormField Text="Password" AllowFloatingLabel="false">
                    <RadzenPassword @bind-Value="@user.Password" Name="Password" />
                    <RadzenRequiredValidator Text="Password is required" Component="Password" />
                    <RadzenLengthValidator Min="6" Text="Password must be at least 6 characters long" Component="Password" />
                </RadzenFormField>
            </RadzenRow>

            @* CONFIRM PASSWORD  *@
            <RadzenRow>
                <RadzenFormField Text="Confirm Password" AllowFloatingLabel="false">
                    <RadzenPassword @bind-Value="@user.RepeatPassword" Name="ConfirmPassword" />
                    <RadzenRequiredValidator Text="Confirming password is required" Component="ConfirmPassword" />
                    <RadzenCompareValidator Text="Passwords do not match" Value=@user.Password Component="ConfirmPassword" Visible=@(!string.IsNullOrEmpty(user.RepeatPassword)) />
                </RadzenFormField>
            </RadzenRow>
       
        
            @* REGISTER, BACK TO LOGIN *@
            <RadzenRow>
                <RadzenButton Style="width:100px; font-size:14px;" Variant="Variant.Outlined" ButtonType="ButtonType.Submit" ButtonStyle="ButtonStyle.Secondary"  Text="Register" />
                <RadzenButton Style="width:100px; font-size:14px;" Variant="Variant.Outlined" ButtonStyle="ButtonStyle.Secondary" Click="@GoToLogin" Text="Back To Login" />
            </RadzenRow>

        </RadzenTemplateForm>

</div>

@code {

    private User user = new User();


    private async Task OnSubmit()
    {
        // Check if passwords match

        // Assume AddUser is updated to handle async operation if necessary
        await UserService.AddUserAsync(user, "Mentor");
        NavigationManager.NavigateTo("/mentor-match");


    }

    void GoToLogin(MouseEventArgs args)
    {
        NavigationManager.NavigateTo("/");
    }
    
}
